<!DOCTYPE html>
<html>
    <head>
        <title>DeWille web admin</title>
        <!--<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>-->
        <script src='static/jquery-3.5.1.min.js'></script>
    </head>
    <body>
        <form method='POST' action='#' enctype='multipart/form-data' id='updateFirmware'>
            <input type='file' name='update'>
            <input type='submit' value='Update Firmware'>
        </form>
        <form method='POST' action='#' enctype='multipart/form-data' id='updateSpiffs'>
            <input type='file' name='update'>
            <input type='submit' value='Update Spiffs'>
        </form>
        <div id='prg'>progress: 0%</div>
        <script>
            $('form').submit(function(e){
                e.preventDefault();
                var formId = e.target.id;
                var form = $('#' + formId)[0];
                var data = new FormData(form);
                var targetUrl = e.target.id;

                $.ajax({
                    url: targetUrl,
                    type: 'POST',
                    data: data,
                    contentType: false,
                    processData: false,
                    xhr: function() {
                        var xhr = new window.XMLHttpRequest();
                        xhr.upload.addEventListener('progress', function(evt) {
                            if (evt.lengthComputable) {
                                var per = evt.loaded / evt.total;
                                $('#prg').html('progress: ' + Math.round(per*100) + '%');
                            }
                        }, false);
                        return xhr;
                    },
                    success:function(d, s) {
                        console.log('success!')
                    },
                    error: function (a, b, c) {
                    }
                });
            });
        </script>
    </body>
</html>

